# Contributor: Tony Davies <anthony.t.davies@gmail.com>
# Maintainer:
pkgname="libstoragemgmt"
pkgver="1.8.1"
pkgrel=1
pkgdesc="Storage array management library"
url="https://github.com/libstorage/libstoragemgmt"
arch="x86_64 armhf armv7"
license="LGPL"
options="!check"
subpackages="$pkgname-doc $pkgname-dev"
depends="py3-six"
makedepends_host="
        sqlite-dev
        libxml2-dev
        glib-dev
        check-dev
        libconfig-dev
        bsd-compat-headers
        eudev-dev
        python3-dev
        perl
        openssl-dev
"
checkdepends="
        check
        chrpath
        valgrind
        libtool
"
install=""
source="https://github.com/libstorage/$pkgname/releases/download/$pkgver/$pkgname-$pkgver.tar.gz
        alpine-macro.patch::https://patch-diff.githubusercontent.com/raw/libstorage/libstoragemgmt/pull/406.patch
        strerr_r_to_strerr_l.patch::https://patch-diff.githubusercontent.com/raw/libstorage/libstoragemgmt/pull/405.patch
        fcntlh_fix.patch::https://patch-diff.githubusercontent.com/raw/libstorage/libstoragemgmt/pull/407.patch
        "

build() {
        pip3 install --user pywbem
        cd "$builddir"
        ./configure \
                --host=$CHOST \
                --build=$CBUILD \
                --prefix=/usr \
                --with-python3 \
                --without-test \
                --disable-static 
        make
#	pip3 uninstall -y pywbem
}

check() {
        make check
}


package() {
        cd "$builddir"
        make DESTDIR="$pkgdir" install
}

sha512sums="88e49a1e65dd0d8388a341365a0bcdfa30c39e1e141eca1c5941f7cdf63783f6c500d73fb4f00d23c0108212a0eab3cb11c9039425b4b57b6a268b09b5c9f888  libstoragemgmt-1.8.1.tar.gz
498015e5240d02a3baf35123ac588452e968dbfc986c58ab701b9881482d4bce59cd0ffc0f5564d03b334eb91ebc47ebd6c9ba23f620c6f3832eeb0dc5720d51  alpine-macro.patch
54d0dba6a6701d537c87614c5c187fcaa99aa164b00b6c327cacee433ab2eed0b3865b11435f859bced77fe1227dab307b010e22a7353c35cc5e3b9765592ecd  strerr_r_to_strerr_l.patch
cb2579786ea11b99d5e8d5c1d46fb4469bd285edf003f2fc92bb8baff37319cd4899ac9228d5f2434d0d3fa8713c54bb6d3c637911388100201ac5eed1efacf1  fcntlh_fix.patch"
