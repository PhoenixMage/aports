# Maintainer: Anthony Davies <anthony.t.davies@gmail.com>
pkgname=external-provisioner
pkgver=1.4.0
pkgrel=0
pkgdesc="Sidecar container that watches Kubernetes PersistentVolumeClaim objects"
url="https://github.com/kubernetes-csi/external-provisioner/"
arch="x86_64 aarch64 armv7"
license="Apache-2.0"
options="!check"
makedepends="go bash" 
source="$pkgname-$pkgver.tar.gz::https://github.com/kubernetes-csi/$pkgname/archive/v$pkgver.tar.gz"
builddir="$srcdir/src/github.com/kubernetes-csi/$pkgname"
subpackages="csi-provisioner"
export GOPATH="$srcdir"


prepare() {
	mkdir -p ${builddir%/*}
	mv "$srcdir"/$pkgname-$pkgver "$builddir"/ || return 1
	cd "$builddir"
	default_prepare
}


build() {
	make
}

package() {
	echo Main package
	mkdir -p $pkgdir
	chmod -R u+w $srcdir || return 0
}

provisioner() {
	echo Packaging csi-provisioner
	cd $builddir
	mkdir -p $subpkgdir/usr/bin
	cp bin/csi-provisioner $subpkgdir/usr/bin/
}
clean() {
	chmod -R u+w $srcdir || return 0
	rm -rf $srcdir
}

sha512sums="dc68c556a7c0838ace415c05b28a4baf99c1f8bc0d7959721dfdfd4f5615e1a537a0987da2c2200acb56f7d3eaee345efb1ca254b59110d5d34c63e40d5d7f57  external-provisioner-1.4.0.tar.gz"
