# Maintainer: Anthony Davies <anthony.t.davies@gmail.com>
pkgname=node-driver-registrar
pkgver=1.1.0
pkgrel=0
pkgdesc="Sidecar container that registers a CSI driver with the kubelet."
url="https://github.com/kubernetes-csi/node-driver-registrar/"
arch="x86_64 aarch64 armv7"
license="Apache-2.0"
options="!check"
makedepends="go bash" 
source="$pkgname-$pkgver.tar.gz::https://github.com/kubernetes-csi/$pkgname/archive/v$pkgver.tar.gz"
builddir="$srcdir/src/github.com/kubernetes-csi/$pkgname"
subpackages="csi-node-driver-registrar"
export GOPATH="$srcdir"


prepare() {
	mkdir -p ${builddir%/*}
	mv "$srcdir"/$pkgname-$pkgver "$builddir"/ || return 1
	cd "$builddir"
	default_prepare
}


build() {
	sed -i -e '/windows/d' release-tools/build.make
	make
}

package() {
	mkdir -p $pkgdir
}

registrar() {
	cd $builddir
	mkdir -p $subpkgdir/usr/bin
	cp bin/csi-node-driver-registrar $subpkgdir/usr/bin/
}

sha512sums="29d4eba8576a042eb1cae2fec2371e043d035fa7d0001d6b94a8fe6de6dbe443b5aa3fa752c852bf32b38433906e1ad5df03ffad3d609884d86e463f9f8eb992  node-driver-registrar-1.1.0.tar.gz"
