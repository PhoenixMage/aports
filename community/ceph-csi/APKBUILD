# Maintainer: Anthony Davies <anthony.t.davies@gmail.com>
pkgname=ceph-csi
pkgver=2.0.0
pkgrel=0
pkgdesc="Ceph CSI Sidecar container"
url="https://github.com/kubernetes-csi/ceph-csi/"
arch="x86_64 aarch64 armv7"
license="Apache-2.0"
options="!check"
makedepends="go bash" 
source="$pkgname-$pkgver.tar.gz::https://github.com/ceph/$pkgname/archive/v$pkgver.tar.gz"
builddir="$srcdir/src/github.com/ceph/$pkgname"
export GOPATH="$srcdir"


prepare() {
	mkdir -p ${builddir%/*}
	mv "$srcdir"/$pkgname-$pkgver "$builddir"/ || return 1
	cd "$builddir"
	default_prepare
}


build() {
	cd $builddir
	sed -i -e 's/LDFLAGS ?=$/LDFLAGS =/' Makefile
	make
}

package() {
	cd $builddir
	mkdir -p $pkgdir/usr/bin
	cp _output/cephcsi $pkgdir/usr/bin
}

sha512sums="e872b914ffd63eff6c68cec28d9bd1ab554fc93e642d7975a3f52a90eaa7eef7bc8790605306c05dce085a8f57cd5181d9347ee4d888eaa7782b143e749bceba  ceph-csi-2.0.0.tar.gz"
